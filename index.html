<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<title>PETA POLYGON KUD BINA SEJAHTERA</title>

<link rel="stylesheet" href="css/leaflet.css">
<link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
<link rel="stylesheet" href="css/qgis2web.css">

<style>
html, body, #map {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
}
</style>
</head>

<body>
<div id="map"></div>

<script src="js/leaflet.js"></script>
<script src="js/L.Control.Layers.Tree.min.js"></script>
<script src="js/leaflet-hash.js"></script>
<script src="data/POLYGON_KUD_BINA_SEJAHTERA_1.js"></script>

<script>
/* ===============================
   INISIALISASI MAP
================================ */
var map = L.map('map', {
    minZoom: 16,
    maxZoom: 19,
    zoomControl: true
}).setView([-3.7357, 105.0866], 16);

new L.Hash(map);

/* ===============================
   XYZ TILES LOKAL (BASEMAP)
================================ */
map.createPane('pane_tiles');
map.getPane('pane_tiles').style.zIndex = 200;

var tiles_lokal = L.tileLayer('tiles/{z}/{x}/{y}.png', {
    pane: 'pane_tiles',
    maxZoom: 19,
    attribution: 'Tiles Â© Wikan'
}).addTo(map);

/* ===============================
   OSM (BASEMAP OPSIONAL)
================================ */
map.createPane('pane_osm');
map.getPane('pane_osm').style.zIndex = 201;

var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    pane: 'pane_osm',
    maxNativeZoom: 19
});

/* ===============================
   STYLE POLYGON
================================ */
map.createPane('pane_polygon');
map.getPane('pane_polygon').style.zIndex = 300;

function style_polygon() {
    return {
        pane: 'pane_polygon',
        color: '#000000',   // garis hitam
        weight: 2,
        dashArray: '',
        fill: true,
        fillColor: '#ffffff', // isi bebas
        fillOpacity: 0.0,     // transparan
        interactive: true
    };
}

/* ===============================
   POPUP POLYGON
================================ */
function popup_polygon(feature, layer) {
    var p = feature.properties;
    var html =
        '<table>' +
        '<tr><th>Nama</th><td>' + (p.Nama ?? '') + '</td></tr>' +
        '<tr><th>Luas_M2</th><td>' + (p.Luas_M2 ?? '') + '</td></tr>' +
        '<tr><th>Total Pohon</th><td>' + (p.Total_poho ?? '') + '</td></tr>' +
        '<tr><th>SPH</th><td>' + (p.SPH ?? '') + '</td></tr>' +
        '<tr><th>Legalitas</th><td>' + (p.Jenis_Lega ?? '') + '</td></tr>' +
        '<tr><th>Nama di SH</th><td>' + (p.Nama_di_SH ?? '') + '</td></tr>' +
        '<tr><th>No SHM</th><td>' + (p.No_SHM ?? '') + '</td></tr>' +
        '</table>';
    layer.bindPopup(html);
}

/* ===============================
   HOVER EFFECT
================================ */
function highlight(e) {
    e.target.setStyle({
        weight: 3,
        color: '#ff0000'
    });
}
function resetHighlight(e) {
    polygon.resetStyle(e.target);
}

/* ===============================
   POLYGON
================================ */
var polygon = L.geoJSON(json_POLYGON_KUD_BINA_SEJAHTERA_1, {
    style: style_polygon,
    onEachFeature: function (feature, layer) {
        popup_polygon(feature, layer);
        layer.on({
            mouseover: highlight,
            mouseout: resetHighlight
        });
        // Nama kebun dimatikan
        // Tidak ada label marker/tooltip
    },
    pane: 'pane_polygon'
}).addTo(map);

map.fitBounds(polygon.getBounds());

/* ===============================
   LAYER CONTROL
================================ */
var baseTree = [
    { label: "XYZ Tiles Lokal", layer: tiles_lokal },
    { label: "OSM Standard", layer: osm }
];

var overlaysTree = [
    { label: "Polygon KUD Bina Sejahtera", layer: polygon }
];

L.control.layers.tree(baseTree, overlaysTree, { collapsed: true }).addTo(map);

</script>

</body>
</html>
